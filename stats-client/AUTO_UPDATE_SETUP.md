# Auto-Update System - Complete Setup Guide

## âœ… What Was Added

Your Electron app now has **automatic update functionality** using `electron-updater`. This allows the app to:

1. âœ… Check for updates automatically on startup
2. âœ… Show update notifications to users
3. âœ… Download updates in the background
4. âœ… Install updates on app restart
5. âœ… Manual update check from Settings page

---

## ğŸ¯ How It Works

### Update Flow

```
1. App starts â†’ Check for updates (after 3 seconds)
2. If update found â†’ Show banner: "Update available: v1.0.2"
3. User clicks "Download" â†’ Download in background
4. Download complete â†’ Show banner: "Update ready - restart to install"
5. User clicks "Restart & Install" â†’ App closes, installs update, restarts
```

### Update Check Locations

- **Automatic:** 3 seconds after app starts (skip in dev mode)
- **Manual:** "Check for Updates" button in Settings page

---

## ğŸ“¦ Hosting Options

You have **2 options** for hosting your updates:

### Option 1: Your Server (allmediamatter.com) - **RECOMMENDED**

**Current Configuration (already set in `package.json`):**

```json
"publish": [
  {
    "provider": "generic",
    "url": "https://allmediamatter.com/downloads/stats-client"
  }
]
```

**What You Need To Do:**

1. **Create Update Directory on Server:**
   ```bash
   mkdir -p /var/www/allmediamatter.com/downloads/stats-client
   ```

2. **Upload These Files After Each Build:**
   ```
   dist/
   â”œâ”€â”€ Affiliate Stats Manager-1.0.2-win-x64.exe
   â”œâ”€â”€ latest.yml  (electron-builder generates this)
   ```

3. **File Structure on Server:**
   ```
   https://allmediamatter.com/downloads/stats-client/
   â”œâ”€â”€ Affiliate Stats Manager-1.0.1-win-x64.exe
   â”œâ”€â”€ Affiliate Stats Manager-1.0.2-win-x64.exe  (new version)
   â”œâ”€â”€ latest.yml  (updated to point to 1.0.2)
   ```

4. **`latest.yml` Format (auto-generated by electron-builder):**
   ```yaml
   version: 1.0.2
   files:
     - url: Affiliate Stats Manager-1.0.2-win-x64.exe
       sha512: [hash]
       size: 73091584
   path: Affiliate Stats Manager-1.0.2-win-x64.exe
   sha512: [hash]
   releaseDate: '2026-01-03T19:00:00.000Z'
   ```

### Option 2: GitHub Releases (Free, Automatic)

If you want to use GitHub instead:

1. **Update `package.json`:**
   ```json
   "publish": [
     {
       "provider": "github",
       "owner": "your-username",
       "repo": "afc-media"
     }
   ]
   ```

2. **Set GitHub Token (for publishing):**
   ```bash
   $env:GH_TOKEN="your_github_personal_access_token"
   npm run build
   ```

3. **Publish to GitHub:**
   ```bash
   npm run publish
   ```

   This will automatically:
   - Create a GitHub Release
   - Upload the `.exe` files
   - Generate and upload `latest.yml`

---

## ğŸš€ Deployment Workflow

### Step 1: Update Version

**In `package.json`:**
```json
{
  "version": "1.0.2"
}
```

### Step 2: Build the App

```bash
cd C:\Users\Chris\Documents\GitHub\afcmedia\stats-client
npm run build
```

**Output:**
```
dist/
â”œâ”€â”€ Affiliate Stats Manager-1.0.2-win-x64.exe
â”œâ”€â”€ latest.yml
â”œâ”€â”€ win-unpacked/  (not needed for updates)
```

### Step 3: Deploy to Server

**Upload to your server:**

```bash
scp "dist/Affiliate Stats Manager-1.0.2-win-x64.exe" user@allmediamatter.com:/var/www/allmediamatter.com/downloads/stats-client/
scp "dist/latest.yml" user@allmediamatter.com:/var/www/allmediamatter.com/downloads/stats-client/
```

**Or via FTP/SFTP:**
1. Connect to allmediamatter.com
2. Navigate to `/downloads/stats-client/`
3. Upload both files

### Step 4: Test the Update

1. **Keep v1.0.1 running** on your machine
2. **Wait 3-5 seconds** after app starts
3. **Should see banner:** "Update available: v1.0.2"
4. **Click "Download"** â†’ Progress bar shows
5. **Click "Restart & Install"** â†’ App updates

---

## ğŸ§ª Testing Updates Locally

### Test Server Setup

You can test updates locally before deploying:

1. **Install `serve` (simple HTTP server):**
   ```bash
   npm install -g serve
   ```

2. **Serve your dist folder:**
   ```bash
   cd C:\Users\Chris\Documents\GitHub\afcmedia\stats-client\dist
   serve -l 8080
   ```

3. **Update `package.json` temporarily:**
   ```json
   "publish": [
     {
       "provider": "generic",
       "url": "http://localhost:8080"
     }
   ]
   ```

4. **Build v1.0.1, run it**
5. **Build v1.0.2, copy to dist**
6. **App should detect local update**

---

## ğŸ“‹ Update Checklist

Before each release:

- [ ] Update version in `package.json`
- [ ] Test all features work
- [ ] Run `npm run build`
- [ ] Test the build locally (run `.exe`)
- [ ] Upload `.exe` and `latest.yml` to server
- [ ] Test update detection with old version
- [ ] Announce update to users (optional)

---

## ğŸ¨ UI Components Added

### 1. Update Banner (Auto-shows)

- **Location:** Top of window
- **Triggers:**
  - Update available
  - Downloading
  - Downloaded (ready to install)
  - Errors
- **Actions:**
  - "Download" button
  - "Restart & Install" button
  - "Dismiss" button

### 2. Settings Page

- **New Section:** "Application Info"
- **Shows:** Current version
- **Button:** "Check for Updates" (manual check)

---

## ğŸ”§ Configuration Options

### Auto-Download

**Current Setting:** `false` (asks user before downloading)

To auto-download updates without asking:

```javascript
// In src/main.js
autoUpdater.autoDownload = true; // Change from false
```

### Update Check Frequency

**Current:** Only on app startup

To check periodically:

```javascript
// In src/main.js, after app.whenReady()
setInterval(() => {
  autoUpdater.checkForUpdates();
}, 1000 * 60 * 60); // Check every hour
```

### Disable Auto-Update (Dev Mode)

Auto-update **automatically skips** in dev mode:

```bash
npm start  # No update check
# or
electron . --dev  # No update check
```

---

## ğŸ› Troubleshooting

### Update Not Detected

1. **Check server URL is accessible:**
   ```bash
   curl https://allmediamatter.com/downloads/stats-client/latest.yml
   ```

2. **Verify `latest.yml` exists and is valid YAML**

3. **Check console logs:**
   ```
   [AUTO-UPDATER] Checking for updates...
   [AUTO-UPDATER] Update available: v1.0.2
   ```

4. **Ensure version in `latest.yml` > current app version**

### "Update Error" Message

**Common Causes:**
- Server not accessible
- `latest.yml` missing or malformed
- `.exe` file not found on server
- SHA512 hash mismatch

**Fix:** Check Activity Log for detailed error message

### Update Downloaded But Won't Install

**Cause:** App might be running as admin or in protected folder

**Fix:** Run app as normal user, not admin

---

## ğŸ“Š Update Statistics

You can track update usage by monitoring server logs:

```bash
# On your server
tail -f /var/log/nginx/access.log | grep "latest.yml"
```

This shows:
- How many users check for updates
- How many download updates
- Which versions are popular

---

## ğŸ”’ Security Considerations

### Code Signing (Recommended for Production)

For maximum security and to avoid Windows warnings:

1. **Get a Code Signing Certificate** ($50-$500/year)
   - DigiCert
   - Sectigo
   - Comodo

2. **Configure in `package.json`:**
   ```json
   "win": {
     "certificateFile": "path/to/cert.pfx",
     "certificatePassword": "your_password",
     "signAndEditExecutable": true
   }
   ```

3. **Build:** electron-builder will sign automatically

### HTTPS Required

- âœ… You're using `https://allmediamatter.com` - good!
- âŒ HTTP is not secure for updates
- âœ… SSL certificate ensures updates aren't tampered with

---

## ğŸ“ Version Numbering

Follow **Semantic Versioning** (semver):

```
MAJOR.MINOR.PATCH

1.0.0 â†’ First release
1.0.1 â†’ Bug fix
1.1.0 â†’ New features (non-breaking)
2.0.0 â†’ Breaking changes
```

**Examples:**
- Fixed MyAffiliates bug â†’ `1.0.1` â†’ `1.0.2`
- Added new provider support â†’ `1.0.2` â†’ `1.1.0`
- Complete UI redesign â†’ `1.1.0` â†’ `2.0.0`

---

## ğŸ‰ Summary

âœ… **Auto-update is now fully configured!**

**What users will see:**
1. Automatic update notifications
2. Easy one-click download
3. Simple restart to install
4. Always on latest version

**What you need to do:**
1. Build new version: `npm run build`
2. Upload to server: `.exe` + `latest.yml`
3. Users auto-update! ğŸš€

---

## ğŸ“ Need Help?

**Files to check:**
- `src/main.js` - Update logic
- `src/preload.js` - API bridge
- `src/renderer/app.js` - UI handlers
- `package.json` - Configuration

**Logs to check:**
- Console: `[AUTO-UPDATER]` messages
- Activity Log in app
- Server access logs

**Test Command:**
```bash
# Install dependencies first
npm install

# Build
npm run build

# Test
cd dist
start "Affiliate Stats Manager-1.0.1-win-x64.exe"
```

---

**Ready to deploy your first update!** ğŸŠ




